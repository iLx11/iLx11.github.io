<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <link rel="alternate icon" type="image/png" href="/img/favicon.png">
    <link rel="stylesheet" media="screen and (max-width:700px)" href="/css/style.css" type="text/css" />
    <link rel="stylesheet" media="screen and (min-width:700px)" href="/css/stylePC.css" type="text/css" />
    <link rel="stylesheet" href="/css/reset.css" type="text/css" />
    <link rel="stylesheet" href="/css/markdown.css" type="text/css" />
    <link rel="stylesheet" href="/css/fonts.css" type="text/css" />

    <title>
        iLx1 |
            
    </title>
    <!-- 
<link rel="stylesheet" href="/css/reset.css">
 -->
    <!-- 
<link rel="stylesheet" href="/css/markdown.css">
 -->
    <!-- 
<link rel="stylesheet" href="/css/fonts.css">
 -->
<meta name="generator" content="Hexo 5.4.2"></head>
    <style>
        /*页面加载开始*/
        .load {
            display: flex;
            flex-flow: column nowrap;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 35em;
            z-index: 999;
        }

        .loader {
            --path: #323641;
            --dot: #6a95bd;
            --duration: 1.5s;
            width: 55px;
            height: 55px;
            align-items: center;
            justify-items: center;
            position: relative;
        }
        .h-mes {
            width: 100%;
            height: 20%;
            position: absolute;
            top: 60%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-flow: column nowrap;
            justify-content: space-evenly;
            align-items: center;
        }
        .h-mes span {
            width: 100%;
            height: 10%;
            text-align: center;
        }
        .loader:before {
            content: "";
            width: 6px;
            height: 6px;
            border-radius: 50%;
            position: absolute;
            display: block;
            background: var(--dot);
            top: 37px;
            left: 19px;
            transform: translate(-18px, -18px);
        }

        .loader svg {
            display: block;
            width: 100%;
            height: 100%;
        }

        .loader svg polygon {
            fill: none;
            stroke: var(--path);
            stroke-width: 10px;
            stroke-linejoin: round;
            stroke-linecap: round;
        }

        .loader svg polygon {
            stroke-dasharray: 145 76 145 76;
            stroke-dashoffset: 0;
            animation: pathTriangle var(--duration) cubic-bezier(0.785, 0.135, 0.15, 0.86) infinite;
        }

        .loader.triangle {
            width: 48px;
        }

        .loader.triangle:before {
            left: 21px;
            transform: translate(-10px, -18px);
            animation: dotTriangle var(--duration) cubic-bezier(0.785, 0.135, 0.15, 0.86) infinite;
        }
        #noWait {
            color: rgba(51,51,51, 0.4);
            margin-top: 3em;
            cursor: pointer;
            display: none;
        }
        @keyframes pathTriangle {
            33% {
                stroke-dashoffset: 74;
            }

            66% {
                stroke-dashoffset: 147;
            }

            100% {
                stroke-dashoffset: 221;
            }
        }

        @keyframes dotTriangle {
            33% {
                transform: translate(0, 0);
            }

            66% {
                transform: translate(10px, -18px);
            }

            100% {
                transform: translate(-10px, -18px);
            }

        }
    </style>

    <body>
        <!-- 页面加载效果 -->
        <div class="load">
            <div class="loader triangle">
                <svg viewBox="0 0 86 80">
                    <polygon points="43 8 79 72 7 72"></polygon>
                </svg>
            </div>
            <div class="h-mes">
                <span id="chs">" 请稍等一会... "</span>
                <span>Please wait for a long time</span>
                <span id="noWait"><我不等啦！></span>
            </div>
        </div>
        
        <!-- 页面加载结束 -->
        <div class="backg"></div>
        <div class="paper">
            <div class="paper-main">
                
                
                <!-- <div class="bgimg"></div> -->
                <div class="cover"></div>
                <!-- <div class="bgimgB"></div> -->
                
                    <div class="post-header">
    <div class="themePage2">Light</div>
    <a class="logo post-header-logo" href="/">iLx1</a>
    <a class="go-home" href="/">
        <svg width="8" height="14" viewBox="0 0 8 14">
            <path d="M7 1L1 7l6 6" stroke="#fff" stroke-width="2" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </a>
</div>
                        
                                    <section class="post-struction">
    <div class="post-main">
        
            <div class="post-main-title">
                VSCode嵌入式
            </div>
            <div class="post-meta">
                2024-02-28
            </div>
            
                <hr>
                <div class="post-md">
                    <h1 id="使用-VSCode-开发嵌入式"><a href="#使用-VSCode-开发嵌入式" class="headerlink" title="使用 VSCode 开发嵌入式"></a>使用 VSCode 开发嵌入式</h1><p>因为是开源的，所以不用寻找激活码或者破解，非常方便、高效，还可以同时配置 esp32 开发环境，或者开发纯软件</p>
<h1 id="环境与工具"><a href="#环境与工具" class="headerlink" title="环境与工具"></a>环境与工具</h1><ul>
<li>Windows 10</li>
<li>STM32CubeMX</li>
<li>vscode </li>
<li>MinGW</li>
<li>OpenOCD</li>
<li>arm-none-eabi-gcc</li>
</ul>
<h2 id="STM32CubeMX"><a href="#STM32CubeMX" class="headerlink" title="STM32CubeMX"></a>STM32CubeMX</h2><p>下载最新版即可</p>
<p>下载链接：</p>
<p><a target="_blank" rel="noopener" href="https://www.st.com/en/development-tools/stm32cubemx.html#get-software">https://www.st.com/en/development-tools/stm32cubemx.html#get-software</a></p>
<h2 id="OpenOCD"><a href="#OpenOCD" class="headerlink" title="OpenOCD"></a>OpenOCD</h2><p>OpenOCD是用于对STM32进行下载仿真的工具，是一个开源软件包，解压到某个目录，后面会在Clion中链接这个目录</p>
<p>下载地址：</p>
<p><a href="https://link.zhihu.com/?target=http://gnutoolchains.com/arm-eabi/openocd/">https://link.zhihu.com/?target=http%3A//gnutoolchains.com/arm-eabi/openocd/</a></p>
<p>下载完成之后将 bin 目录添加到系统环境变量中</p>
<p>右键 “此电脑” -》 “属性” -》找到 “高级系统设置” -》 “环境变量” -》”系统变量” -》”path”双击 -》”新建”</p>
<h2 id="vscode"><a href="#vscode" class="headerlink" title="vscode"></a>vscode</h2><p>下载地址：</p>
<p><a target="_blank" rel="noopener" href="https://code.visualstudio.com/Download">https://code.visualstudio.com/Download</a></p>
<p>同样把 vscode 的安装 bin 目录添加到系统环境变量中</p>
<h2 id="MinGW"><a href="#MinGW" class="headerlink" title="MinGW"></a>MinGW</h2><p>具体参考我的另一篇文章，”CLion 嵌入式”</p>
<p>下载完成之后将<code>mingw64/bin</code> 目录添加到系统环境变量中</p>
<h2 id="arm-none-eabi-gcc"><a href="#arm-none-eabi-gcc" class="headerlink" title="arm-none-eabi-gcc"></a>arm-none-eabi-gcc</h2><p>下载链接：</p>
<p><a target="_blank" rel="noopener" href="https://developer.arm.com/downloads/-/gnu-rm">https://developer.arm.com/downloads/-/gnu-rm</a></p>
<p>解压后将 bin目录添加到系统环境变量中</p>
<h2 id="所有环境配置完成之后"><a href="#所有环境配置完成之后" class="headerlink" title="所有环境配置完成之后"></a>所有环境配置完成之后</h2><p>打开 cmd 依次输入，如果都有信息输出则为配置成功</p>
<pre><code class="shell">mingw32-make -v
arm-none-eabi-gcc -v
openocd -v
</code></pre>
<h1 id="创建工程"><a href="#创建工程" class="headerlink" title="创建工程"></a>创建工程</h1><p>打开 cubeMX 配置好板子之后</p>
<p>工程管理<code>Toolchain/IDE</code> 选择 Makefile 就可以</p>
<p><img src="https://picr.oss-cn-qingdao.aliyuncs.com/img/202402282303760.png" alt="image-20240228230322221"></p>
<p>在生成的工程文件夹中，打开终端 cmd ，输入</p>
<pre><code class="shell">code .
</code></pre>
<p>表示用 vscode 打开，如果报错说明 vscode 没有正确添加到系统目录中，也可以拖动打开</p>
<p>在终端中输入，就可以对工程进行编译</p>
<pre><code class="shell">mingw32-make
</code></pre>
<p>如果没有问题会显示下面的输出，并在工程文件夹中生成 <code>build</code> 目录</p>
<p>以及 <code>elf</code> 、<code>hex\bin</code> 文件</p>
<p><img src="https://picr.oss-cn-qingdao.aliyuncs.com/img/202402282307284.png" alt="image-20240228230742853"></p>
<h2 id="下载到硬件"><a href="#下载到硬件" class="headerlink" title="下载到硬件"></a>下载到硬件</h2><h3 id="如果是-DapLink"><a href="#如果是-DapLink" class="headerlink" title="如果是 DapLink"></a>如果是 DapLink</h3><pre><code class="shell">openocd -f interface/cmsis-dap.cfg -f target/stm32f1x.cfg -c &quot;program build/&lt;工程名&gt;.elf verify reset exit&quot;
</code></pre>
<h3 id="如果是-ST-Link"><a href="#如果是-ST-Link" class="headerlink" title="如果是 ST-Link"></a>如果是 ST-Link</h3><pre><code class="shell">openocd -f interface/stlink.cfg -f target/stm32f1x.cfg -c &quot;program build/&lt;工程名&gt;.elf verify reset exit&quot;
</code></pre>
<p>其中 <code>stm32f1x.cfg</code> 可以在 openocd 安装目录 <code>share/openocd/scripts/target</code>，中找到适合自己的板子进行更换</p>
<p><code>&lt;工程名&gt;</code> 表示需要替换成自己的工程名</p>
<h2 id="配置任务"><a href="#配置任务" class="headerlink" title="配置任务"></a>配置任务</h2><p>如果是输入命令行的方式编译和下载非常的不方便，所以需要在 vscode 中创建任务，我们只执行任务就可以了</p>
<p>点击终端-&gt;配置任务-&gt;创建 / 打开 task.json</p>
<h5 id="以后的开发只需要把这个文件复制到-vscode目录下就可以"><a href="#以后的开发只需要把这个文件复制到-vscode目录下就可以" class="headerlink" title="以后的开发只需要把这个文件复制到 .vscode目录下就可以"></a>以后的开发只需要把这个文件复制到 <code>.vscode</code>目录下就可以</h5><pre><code class="json">&#123;
  // See https://go.microsoft.com/fwlink/?LinkId=733558
  // for the documentation about the tasks.json format
  &quot;version&quot;: &quot;2.0.0&quot;,
  &quot;tasks&quot;: [
    &#123;
      &quot;label&quot;: &quot;download&quot;,
      &quot;type&quot;: &quot;shell&quot;,
      &quot;command&quot;: &quot;openocd&quot;,
      &quot;args&quot;: [
        &quot;-f&quot;,
        &quot;interface/stlink.cfg&quot;,
        &quot;-f&quot;,
        &quot;target/stm32f1x.cfg&quot;,
        &quot;-c&quot;,
        &quot;program build/test.elf verify reset exit&quot;
      ],
      &quot;presentation&quot;: &#123;
        &quot;echo&quot;: true,
        &quot;reveal&quot;: &quot;always&quot;,
        &quot;focus&quot;: true,
        &quot;panel&quot;: &quot;shared&quot;,
        &quot;showReuseMessage&quot;: false,
        &quot;clear&quot;: false
      &#125;,
      &quot;problemMatcher&quot;: []
    &#125;,
    &#123;
      &quot;label&quot;: &quot;build&quot;,
      &quot;type&quot;: &quot;shell&quot;,
      &quot;command&quot;: &quot;mingw32-make&quot;,
      &quot;args&quot;: [
        &quot;-j8&quot;
      ],
      &quot;presentation&quot;: &#123;
        &quot;echo&quot;: true,
        &quot;reveal&quot;: &quot;always&quot;,
        &quot;focus&quot;: true,
        &quot;panel&quot;: &quot;shared&quot;,
        &quot;showReuseMessage&quot;: false,
        &quot;clear&quot;: false
      &#125;,
      &quot;group&quot;: &#123;
        &quot;kind&quot;: &quot;build&quot;,
        &quot;isDefault&quot;: true
      &#125;
    &#125;,
    &#123;
      &quot;label&quot;: &quot;clean&quot;,
      &quot;type&quot;: &quot;shell&quot;,
      &quot;command&quot;: &quot;make&quot;,
      &quot;args&quot;: [
        &quot;clean&quot;
      ],
      &quot;presentation&quot;: &#123;
        &quot;echo&quot;: true,
        &quot;reveal&quot;: &quot;always&quot;,
        &quot;focus&quot;: true,
        &quot;panel&quot;: &quot;shared&quot;,
        &quot;showReuseMessage&quot;: false,
        &quot;clear&quot;: false
      &#125;
    &#125;,
    &#123;
      &quot;label&quot;: &quot;rebuild&quot;,
      &quot;type&quot;: &quot;shell&quot;,
      &quot;dependsOrder&quot;: &quot;sequence&quot;,
      &quot;dependsOn&quot;: [
        &quot;clean&quot;,
        &quot;build&quot;
      ]
    &#125;
  ]
&#125;
</code></pre>
<h4 id="熟悉的命令行就变成配置内容，并且填写在这个文件中了，然后可以找到对应位置修改"><a href="#熟悉的命令行就变成配置内容，并且填写在这个文件中了，然后可以找到对应位置修改" class="headerlink" title="熟悉的命令行就变成配置内容，并且填写在这个文件中了，然后可以找到对应位置修改"></a>熟悉的命令行就变成配置内容，并且填写在这个文件中了，然后可以找到对应位置修改</h4><h3 id="运行任务时："><a href="#运行任务时：" class="headerlink" title="运行任务时："></a>运行任务时：</h3><p>点击终端 -&gt; 运行任务 -&gt; build / download</p>
<h2 id="调试程序"><a href="#调试程序" class="headerlink" title="调试程序"></a>调试程序</h2><p>编译和下载完成之后就可以进一步调试了</p>
<h4 id="点击左边工具栏有虫子的图标-》运行和调试-》-创建launch-json文件-》选择cortex-debug"><a href="#点击左边工具栏有虫子的图标-》运行和调试-》-创建launch-json文件-》选择cortex-debug" class="headerlink" title="点击左边工具栏有虫子的图标 -》运行和调试 -》 创建launch.json文件 -》选择cortex-debug"></a>点击左边工具栏有虫子的图标 -》运行和调试 -》 创建launch.json文件 -》选择cortex-debug</h4><p>默认会创建一个jlink的配置</p>
<h3 id="替换为"><a href="#替换为" class="headerlink" title="替换为"></a>替换为</h3><pre><code class="json">&#123;
    &quot;version&quot;: &quot;0.2.0&quot;,
    &quot;configurations&quot;: [
        &#123;
            &quot;name&quot;: &quot;Cortex Debug&quot;,
            &quot;cwd&quot;: &quot;$&#123;workspaceFolder&#125;&quot;,
            &quot;svdFile&quot;: &quot;STM32F103.svd&quot;,
            &quot;executable&quot;: &quot;build/&lt;工程名&gt;.elf&quot;,
            &quot;configFiles&quot;: [
                &quot;interface/stlink.cfg&quot;,
                &quot;target/stm32f1x.cfg&quot;,
            ],
            &quot;request&quot;: &quot;launch&quot;,
            &quot;type&quot;: &quot;cortex-debug&quot;,
            &quot;runToEntryPoint&quot;: &quot;main&quot;,
            &quot;servertype&quot;: &quot;openocd&quot;,
            &quot;liveWatch&quot;: &#123;
                &quot;enabled&quot;: true,
                &quot;samplesPerSecond&quot;: 1
            &#125;
        &#125;
    ]
&#125;
</code></pre>
<h3 id="按下-F5-进入调试"><a href="#按下-F5-进入调试" class="headerlink" title="按下 F5 进入调试"></a>按下 F5 进入调试</h3><h2 id="printf-重定向"><a href="#printf-重定向" class="headerlink" title="printf 重定向"></a>printf 重定向</h2><h3 id="使串口支持-printf-和-fprintf（可选）"><a href="#使串口支持-printf-和-fprintf（可选）" class="headerlink" title="使串口支持 printf 和 fprintf（可选）"></a>使串口支持 printf 和 fprintf（可选）</h3><p>在makefile的145行左右，添加以下代码</p>
<pre><code class="c">-u_printf_float -u_fprintf_float 
</code></pre>
<p>重写函数</p>
<pre><code class="c">//printf的重定向
//1、使用printf一定要加\n
//2、使用时 包含stdio.h
//3、makefile 145h 加-u_printf_float以支持输出浮点数 printf输出到设备
//4、makefile 145h 加-u_fprintf_float以支持fprontf输出浮点数 fprintf输出到文件
#ifdef __GNUC__
    #define PUTCHAR_PROTOTYPE int __io_putchar(int ch)
#else
    #define PUTCHAR_PROTOTYPE int fputc(int ch, FILE *f)
#endif
PUTCHAR_PROTOTYPE
&#123;
  uint8_t temp[1]=&#123;ch&#125;;
  HAL_UART_Transmit(&amp;huart1,temp,1,0xffff);//要提前配置huart1，PA9_TX PA10_RX
  return ch;
&#125;
int _write(int file, char *ptr, int len)
&#123;
  int DataIdx;
  for (DataIdx=0;DataIdx&lt;len;DataIdx++)
  &#123;
    __io_putchar(*ptr++);
  &#125;
  return len;
&#125;
</code></pre>
<h3 id="使用时"><a href="#使用时" class="headerlink" title="使用时"></a>使用时</h3><pre><code class="c">printf(&quot;hello world \n&quot;);
</code></pre>

                </div>

                <div class="menuShow">
                    <svg t="1663413277234" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2403" width="24" height="24">
                        <path
                            d="M640 192H224c-17.7 0-32-14.3-32-32s14.3-32 32-32h416c17.7 0 32 14.3 32 32s-14.3 32-32 32zM960 544H224c-17.7 0-32-14.3-32-32s14.3-32 32-32h736c17.7 0 32 14.3 32 32s-14.3 32-32 32zM640 896H224c-17.7 0-32-14.3-32-32s14.3-32 32-32h416c17.7 0 32 14.3 32 32s-14.3 32-32 32zM96 192H64c-17.7 0-32-14.3-32-32s14.3-32 32-32h32c17.7 0 32 14.3 32 32s-14.3 32-32 32zM96 544H64c-17.7 0-32-14.3-32-32s14.3-32 32-32h32c17.7 0 32 14.3 32 32s-14.3 32-32 32zM96 896H64c-17.7 0-32-14.3-32-32s14.3-32 32-32h32c17.7 0 32 14.3 32 32s-14.3 32-32 32z"
                            fill="#707070" p-id="2404" data-spm-anchor-id="a313x.7781069.0.i0" class="selected"></path>
                    </svg>
                </div>
                <div class="top">
                    <svg width="8" height="14" viewBox="0 0 8 14">
                        <path d="M7 1L1 7l6 6" stroke="#fff" stroke-width="2" fill="none" fill-rule="evenodd"
                            stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </div>
    </div>
    <div class="menu">
        <ul>
        </ul>
    </div>
</section>
<script src="/js/nav.js"></script>
<!-- 
<script src="/js/nav.js"></script>
 -->
                                        <div class="footer">
    <span>Copyright © 2022 iLx1</span>
</div>

<link rel="stylesheet" href="/css/nord.css" type="text/css" />
<script src="/js/highlight.min.js"></script>
<script src="/js/highlightjs-line-numbers.js"></script>

<!-- 
<link rel="stylesheet" href="/css/nord.css">

    
<script src="/js/highlight.min.js"></script>

        
<script src="/js/highlightjs-line-numbers.js"></script>
 -->

<script>
    hljs.initHighlightingOnLoad();
    hljs.initLineNumbersOnLoad();
</script>
            </div>
        </div>
        <script>
            const loader = document.querySelector('.load');
            const paper = document.querySelector('.paper');
            const ch_span = document.querySelector('.load .h-mes>#chs');
            const no_wait = document.querySelector('.load #noWait');
    
            const ch_array = ['" 或许再等一会.. "', '" 等待是为了更好的阅读体验 "', '" 就快加载完了 "', '" 还差一点... "', '" 感谢你的坚持 ! "']
            let i = 0, j = 0;
            var show_main = setInterval(() => {
                ch_span.innerHTML = ch_array[i];
                i > 3 ? i = 0 : i ++;
                j > 1 ? no_wait.style.display = 'block' : j ++;
            }, 1800);
            // console.log(23542365)
            window.addEventListener('load',showMain);
            no_wait.addEventListener('click', showMain);
    
            function showMain() {
                loader.style.display = 'none';
                paper.style.display = 'block';
                show_main = null;
                clearInterval(show_main);
                console.log(1)
            }
        </script>
    </body>
</html>