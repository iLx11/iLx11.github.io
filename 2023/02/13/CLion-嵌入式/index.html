<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <link rel="alternate icon" type="image/png" href="/img/favicon.png">
    <link rel="stylesheet" media="screen and (max-width:700px)" href="/css/style.css" type="text/css" />
    <link rel="stylesheet" media="screen and (min-width:700px)" href="/css/stylePC.css" type="text/css" />
    <link rel="stylesheet" href="/css/reset.css" type="text/css" />
    <link rel="stylesheet" href="/css/markdown.css" type="text/css" />
    <link rel="stylesheet" href="/css/fonts.css" type="text/css" />

    <title>
        iLx1 |
            
    </title>
    <!-- 
<link rel="stylesheet" href="/css/reset.css">
 -->
    <!-- 
<link rel="stylesheet" href="/css/markdown.css">
 -->
    <!-- 
<link rel="stylesheet" href="/css/fonts.css">
 -->
<meta name="generator" content="Hexo 5.4.2"></head>
    <style>
        /*页面加载开始*/
        .load {
            display: flex;
            flex-flow: column nowrap;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 35em;
            z-index: 999;
        }

        .loader {
            --path: #323641;
            --dot: #6a95bd;
            --duration: 1.5s;
            width: 55px;
            height: 55px;
            align-items: center;
            justify-items: center;
            position: relative;
        }
        .h-mes {
            width: 100%;
            height: 20%;
            position: absolute;
            top: 60%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-flow: column nowrap;
            justify-content: space-evenly;
            align-items: center;
        }
        .h-mes span {
            width: 100%;
            height: 10%;
            text-align: center;
        }
        .loader:before {
            content: "";
            width: 6px;
            height: 6px;
            border-radius: 50%;
            position: absolute;
            display: block;
            background: var(--dot);
            top: 37px;
            left: 19px;
            transform: translate(-18px, -18px);
        }

        .loader svg {
            display: block;
            width: 100%;
            height: 100%;
        }

        .loader svg polygon {
            fill: none;
            stroke: var(--path);
            stroke-width: 10px;
            stroke-linejoin: round;
            stroke-linecap: round;
        }

        .loader svg polygon {
            stroke-dasharray: 145 76 145 76;
            stroke-dashoffset: 0;
            animation: pathTriangle var(--duration) cubic-bezier(0.785, 0.135, 0.15, 0.86) infinite;
        }

        .loader.triangle {
            width: 48px;
        }

        .loader.triangle:before {
            left: 21px;
            transform: translate(-10px, -18px);
            animation: dotTriangle var(--duration) cubic-bezier(0.785, 0.135, 0.15, 0.86) infinite;
        }
        #noWait {
            color: rgba(51,51,51, 0.4);
            margin-top: 3em;
            cursor: pointer;
            display: none;
        }
        @keyframes pathTriangle {
            33% {
                stroke-dashoffset: 74;
            }

            66% {
                stroke-dashoffset: 147;
            }

            100% {
                stroke-dashoffset: 221;
            }
        }

        @keyframes dotTriangle {
            33% {
                transform: translate(0, 0);
            }

            66% {
                transform: translate(10px, -18px);
            }

            100% {
                transform: translate(-10px, -18px);
            }

        }
    </style>

    <body>
        <!-- 页面加载效果 -->
        <div class="load">
            <div class="loader triangle">
                <svg viewBox="0 0 86 80">
                    <polygon points="43 8 79 72 7 72"></polygon>
                </svg>
            </div>
            <div class="h-mes">
                <span id="chs">" 请稍等一会... "</span>
                <span>Please wait for a long time</span>
                <span id="noWait"><我不等啦！></span>
            </div>
        </div>
        
        <!-- 页面加载结束 -->
        <div class="backg"></div>
        <div class="paper">
            <div class="paper-main">
                
                
                <!-- <div class="bgimg"></div> -->
                <div class="cover"></div>
                <!-- <div class="bgimgB"></div> -->
                
                    <div class="post-header">
    <div class="themePage2">Light</div>
    <a class="logo" href="/">iLx1</a>
    <a class="go-home" href="/">
        <svg width="8" height="14" viewBox="0 0 8 14">
            <path d="M7 1L1 7l6 6" stroke="#fff" stroke-width="2" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </a>
</div>
                        
                                    <section class="post-struction">
    <div class="post-main">
        
            <div class="post-main-title">
                CLion-嵌入式
            </div>
            <div class="post-meta">
                2023-02-13
            </div>
            
                <hr>
                <div class="post-md">
                    <h3 id="取代-keil-迁移到更高级的-IDE"><a href="#取代-keil-迁移到更高级的-IDE" class="headerlink" title="取代 keil 迁移到更高级的 IDE"></a>取代 keil 迁移到更高级的 IDE</h3><p>CLion 有强大的代码补全、界面风格、各种插件、流畅性等众多优点</p>
<h5 id="基于HAL库开发为准"><a href="#基于HAL库开发为准" class="headerlink" title="基于HAL库开发为准"></a>基于<code>HAL库</code>开发为准</h5><h1 id="环境与工具"><a href="#环境与工具" class="headerlink" title="环境与工具"></a>环境与工具</h1><ul>
<li>Windows 10</li>
<li>STM32CubeMX</li>
<li>Clion</li>
<li>MinGW</li>
<li>OpenOCD</li>
<li>arm-none-eabi-gcc</li>
</ul>
<h2 id="STM32CubeMX"><a href="#STM32CubeMX" class="headerlink" title="STM32CubeMX"></a>STM32CubeMX</h2><p>下载最新版即可</p>
<p>下载链接：</p>
<p><a target="_blank" rel="noopener" href="https://www.st.com/en/development-tools/stm32cubemx.html#get-software">https://www.st.com/en/development-tools/stm32cubemx.html#get-software</a></p>
<h2 id="OpenOCD"><a href="#OpenOCD" class="headerlink" title="OpenOCD"></a>OpenOCD</h2><p>OpenOCD是用于对STM32进行下载仿真的工具，是一个开源软件包，解压到某个目录，后面会在Clion中链接这个目录</p>
<p>下载地址：</p>
<p><a href="https://link.zhihu.com/?target=http://gnutoolchains.com/arm-eabi/openocd/">https://link.zhihu.com/?target=http%3A//gnutoolchains.com/arm-eabi/openocd/</a></p>
<h2 id="CLion"><a href="#CLion" class="headerlink" title="CLion"></a>CLion</h2><p>在官网下载 2022 / 2023 的版本即可</p>
<p>然后在下面的网址找一个能用的激活码，翻翻评论之类的，输入 Clion  进行激活</p>
<p><a target="_blank" rel="noopener" href="https://gist.github.com/ihabhamad/3fc931475b1fcc4528ec43be6fae624e?permalink_comment_id=4620170">https://gist.github.com/ihabhamad/3fc931475b1fcc4528ec43be6fae624e?permalink_comment_id=4620170</a></p>
<h4 id="在CLion-中配置-OpenOCD-与上一步下载的-STM32CubeMX"><a href="#在CLion-中配置-OpenOCD-与上一步下载的-STM32CubeMX" class="headerlink" title="在CLion 中配置 OpenOCD 与上一步下载的 STM32CubeMX"></a>在CLion 中配置 OpenOCD 与上一步下载的 STM32CubeMX</h4><p><img src="https://picr.oss-cn-qingdao.aliyuncs.com/img/202308121439179.png" alt="image-20230213124855858"></p>
<h2 id="MinGW"><a href="#MinGW" class="headerlink" title="MinGW"></a>MinGW</h2><p>直接下载 MSYS2 包管理器下载 mingw64 即可，之后配置时会自动检测到。如果没有检测到的话，就手动导入包管理工具安装的目录找到 mingw64 就好。</p>
<p>以下是安装环境的教程：</p>
<h3 id="安装MSYS2"><a href="#安装MSYS2" class="headerlink" title="安装MSYS2"></a>安装MSYS2</h3><p>MSYS2 也是一个包管理软件，用来安装环境非常简单。推荐使用。</p>
<p><a target="_blank" rel="noopener" href="https://www.lovestu.com/wp-content/plugins/cp-link-open/link.php?a=aHR0cHM6Ly93d3cubXN5czIub3JnLw==">https://www.msys2.org/</a></p>
<p>进入官网，下载安装包即可。</p>
<p><img src="https://www.lovestu.com/wp-content/uploads/2022/09/1662985763379.webp" alt="img"></p>
<p>安装包一路下一步即可，我是安装在D盘的。</p>
<p>进入：D:\msys64，启动msys2.exe。</p>
<p>输入<code>pacman -Su</code> 更新一下包，一路Y即可</p>
<p><img src="https://www.lovestu.com/wp-content/uploads/2022/09/1662985989564.webp" alt="img"></p>
<p>第二次输入Y以后，窗口会关闭。再次打开即可。</p>
<h3 id="安装MinGW"><a href="#安装MinGW" class="headerlink" title="安装MinGW"></a>安装MinGW</h3><p>在msys2中输入命令</p>
<pre><code>pacman -Sy base-devel
</code></pre>
<p>然后输入Y即可，稍等一会，即可安装完成。然后安装mingw环境。还是Y即可。</p>
<pre><code> pacman -S mingw-w64-x86_64-toolchain
</code></pre>
<p>这样，就把所有的环境给安装下来了，非常简单。</p>
<p>至此，需要的东西，全部都给安装下来了，可以愉快的玩耍C语言了。</p>
<h3 id="配置平时C语言编译环境"><a href="#配置平时C语言编译环境" class="headerlink" title="配置平时C语言编译环境"></a>配置平时C语言编译环境</h3><p>和配置硬件的编译环境有区别</p>
<p>之前安装好了MinGW，一般就在msys64的目录下，我默认在C盘，我msys64安装在D盘，所以MinGW也在D盘。</p>
<p>有mingw64和mingw32，64位系统用mingw64就好，按照下图配置好构建工具和编译器就行。</p>
<p><img src="https://picr.oss-cn-qingdao.aliyuncs.com/img/202308121440615.webp" alt="img"></p>
<p>然后设置CMake，默认是Debug，如果没有，手动添加就是了。这儿是可以设置多个编译器环境的，例如使用微软的MSVC，当然了，我们只安装了MinGW，用这个就好了。</p>
<p><img src="https://picr.oss-cn-qingdao.aliyuncs.com/img/202308121440539.webp" alt="img"></p>
<h2 id="arm-none-eabi-gcc"><a href="#arm-none-eabi-gcc" class="headerlink" title="arm-none-eabi-gcc"></a>arm-none-eabi-gcc</h2><p>下载链接：</p>
<p><a target="_blank" rel="noopener" href="https://developer.arm.com/downloads/-/gnu-rm">https://developer.arm.com/downloads/-/gnu-rm</a></p>
<p><img src="https://picr.oss-cn-qingdao.aliyuncs.com/img/202308121441954.png" alt="image-20230213125939109"></p>
<h5 id="解压后将-bin-目录配置到系统环境目录"><a href="#解压后将-bin-目录配置到系统环境目录" class="headerlink" title="解压后将 bin 目录配置到系统环境目录"></a>解压后将 bin 目录配置到系统环境目录</h5><p>cmd 输入</p>
<pre><code class="bash">arm-none-eabi-gcc -v
</code></pre>
<p>如果有信息输出,那就是装好了</p>
<h3 id="CLion-配置硬件开发编译环境"><a href="#CLion-配置硬件开发编译环境" class="headerlink" title="CLion 配置硬件开发编译环境"></a>CLion 配置硬件开发编译环境</h3><p><img src="https://picr.oss-cn-qingdao.aliyuncs.com/img/202308121441069.png" alt="image-20230812143107205"></p>
<h2 id="CLion-中创建-STM32-工程"><a href="#CLion-中创建-STM32-工程" class="headerlink" title="CLion 中创建 STM32 工程"></a>CLion 中创建 STM32 工程</h2><h4 id="创建一个新工程"><a href="#创建一个新工程" class="headerlink" title="创建一个新工程"></a>创建一个新工程</h4><p><img src="https://picr.oss-cn-qingdao.aliyuncs.com/img/202308121441016.png" alt="image-20230213154707455"></p>
<h4 id="完成后点击create"><a href="#完成后点击create" class="headerlink" title="完成后点击create"></a>完成后点击create</h4><h5 id="如遇以下问题（如果安装的是新版的CLion-则不会遇到）"><a href="#如遇以下问题（如果安装的是新版的CLion-则不会遇到）" class="headerlink" title="如遇以下问题（如果安装的是新版的CLion 则不会遇到）"></a>如遇以下问题（如果安装的是新版的CLion 则不会遇到）</h5><p>‘please install java jre xxxxxxxxx’</p>
<p><img src="https://img.gejiba.com/images/552f4a051e8d1706032592e7a5ebd489.png" alt="image-20230213154844389"></p>
<h5 id="解决方式："><a href="#解决方式：" class="headerlink" title="解决方式："></a>解决方式：</h5><p>删除CLion 安装目录下的jbr文件夹，将新版安装目录下的jbr文件夹拷贝进来</p>
<p>jbr文件下载：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/JetBrains/JetBrainsRuntime/releases/tag/jbr11_0_13b1751.25">https://github.com/JetBrains/JetBrainsRuntime/releases/tag/jbr11_0_13b1751.25</a></p>
<p>解压后替换即可</p>
<h3 id="点击-Open-with-STM32CubeMX"><a href="#点击-Open-with-STM32CubeMX" class="headerlink" title="点击 Open with STM32CubeMX"></a>点击 Open with STM32CubeMX</h3><h3 id="在-stm32cubemx-中的重要配置"><a href="#在-stm32cubemx-中的重要配置" class="headerlink" title="在 stm32cubemx 中的重要配置"></a>在 stm32cubemx 中的重要配置</h3><p>（配置好板子之类的自己的需求后）</p>
<p><img src="https://picr.oss-cn-qingdao.aliyuncs.com/img/202308121444109.png" alt="image-20230213155707849"></p>
<p>生成的代码会分开单独的源文件和头文件，否则会全部放在main.c文件，不便于整理，降低代码可读性</p>
<p><img src="https://picr.oss-cn-qingdao.aliyuncs.com/img/202308121443989.png" alt="image-20230213155854761"></p>
<h4 id="配置完成后点击"><a href="#配置完成后点击" class="headerlink" title="配置完成后点击"></a>配置完成后点击</h4><p><img src="https://picr.oss-cn-qingdao.aliyuncs.com/img/202308121443450.png" alt="image-20230213161311788"></p>
<h4 id="遇到这个框点击-close"><a href="#遇到这个框点击-close" class="headerlink" title="遇到这个框点击 close"></a>遇到这个框点击 close</h4><p><img src="https://picr.oss-cn-qingdao.aliyuncs.com/img/202308121444919.png" alt="image-20230213161401668"></p>
<h4 id="之后返回-CLion"><a href="#之后返回-CLion" class="headerlink" title="之后返回 CLion"></a>之后返回 CLion</h4><p>这个是板子配置文件，我们先不选择，之后进行配置</p>
<p><img src="https://picr.oss-cn-qingdao.aliyuncs.com/img/202308121443652.png" alt="image-20230213161600221"></p>
<h4 id="在工程文件夹下创建-config-目录"><a href="#在工程文件夹下创建-config-目录" class="headerlink" title="在工程文件夹下创建 config 目录"></a>在工程文件夹下创建 config 目录</h4><h4 id="config-目录下-新建命名为-stlink-cfg-daplink-的文件"><a href="#config-目录下-新建命名为-stlink-cfg-daplink-的文件" class="headerlink" title="config 目录下 新建命名为  stlink.cfg/daplink  的文件"></a>config 目录下 新建命名为  stlink.cfg/daplink  的文件</h4><h5 id="文件中粘贴硬件配置"><a href="#文件中粘贴硬件配置" class="headerlink" title="文件中粘贴硬件配置"></a>文件中粘贴硬件配置</h5><p>前两行设置了仿真器的类型和接口，下面几行指定了<strong>Flash大小</strong>、<strong>芯片类型</strong>、<strong>下载速度</strong>等，如果这些参数不一样可以根据实际情况更改以下文件</p>
<p>如果对自己的芯片不知道怎么设置，可以参考OpenOCD自带的一系列配置文件，路径在OpenOCD安装目录的<code>share\openocd\scripts</code>下：</p>
<p>只需要关注这几个目录：</p>
<ul>
<li><strong>board</strong>：板卡配置，各种官方板卡</li>
<li><strong>interface</strong>：仿真器类型配置，比如ST-Link、CMSIS-DAP等都在里面</li>
<li><strong>target</strong>：芯片类型配置，STM32F1xx、STM32L0XX等等都在里面</li>
</ul>
<h5 id="stlink"><a href="#stlink" class="headerlink" title="stlink"></a>stlink</h5><pre><code class="bash"># choose st-link/j-link/dap-link etc.
#adapter driver cmsis-dap
#transport select swd
 
source [find interface/stlink.cfg]
transport select hla_swd
 
source [find target/stm32f1x.cfg]
 
# download speed = 10MHz
adapter speed 10000
</code></pre>
<h5 id="daplink"><a href="#daplink" class="headerlink" title="daplink"></a>daplink</h5><pre><code class="bash"># choose st-link/j-link/dap-link etc.
source [find interface/cmsis-dap.cfg]
transport select swd
# 0x10000 = 64K Flash Size
# 0x80000 = 512K Flash Size
set FLASH_SIZE 0x20000
source [find target/stm32f4x.cfg]
# download speed = 10MHz
adapter speed 10000
#reset_config none
</code></pre>
<h3 id="编译-amp-烧录-amp-调试"><a href="#编译-amp-烧录-amp-调试" class="headerlink" title="编译 &amp;  烧录 &amp; 调试"></a>编译 &amp;  烧录 &amp; 调试</h3><p><img src="https://picr.oss-cn-qingdao.aliyuncs.com/img/202308121448988.png" alt="image-20230213163258711"></p>
<img src="https://picr.oss-cn-qingdao.aliyuncs.com/img/202308121448875.png" alt="image-20230213163437368" style="zoom:80%;" />



<h4 id="选择配置文件"><a href="#选择配置文件" class="headerlink" title="选择配置文件"></a>选择配置文件</h4><p><img src="https://picr.oss-cn-qingdao.aliyuncs.com/img/202308121449374.png" alt="image-20230213163609813"></p>
<h4 id="则配置完成"><a href="#则配置完成" class="headerlink" title="则配置完成"></a>则配置完成</h4><h3 id="点击编译按钮"><a href="#点击编译按钮" class="headerlink" title="点击编译按钮"></a>点击编译按钮</h3><h4 id="用于烧录的-hex-和-bin-文件将在工程目录下生成，此步用于串口烧录"><a href="#用于烧录的-hex-和-bin-文件将在工程目录下生成，此步用于串口烧录" class="headerlink" title="用于烧录的 .hex 和 .bin 文件将在工程目录下生成，此步用于串口烧录"></a>用于烧录的 .hex 和 .bin 文件将在工程目录下生成，此步用于串口烧录</h4><h5 id="目录名："><a href="#目录名：" class="headerlink" title="目录名："></a>目录名：</h5><pre><code class="bash">cmake-build-debug-mingw
</code></pre>
<h3 id="点击上传-烧录按钮"><a href="#点击上传-烧录按钮" class="headerlink" title="点击上传/烧录按钮"></a>点击上传/烧录按钮</h3><h4 id="如果在上面配置了下载器，并连接好了板子，将会直接烧录"><a href="#如果在上面配置了下载器，并连接好了板子，将会直接烧录" class="headerlink" title="如果在上面配置了下载器，并连接好了板子，将会直接烧录"></a>如果在上面配置了下载器，并连接好了板子，将会直接烧录</h4><h3 id="增加断点后可以进行调试"><a href="#增加断点后可以进行调试" class="headerlink" title="增加断点后可以进行调试"></a>增加断点后可以进行调试</h3><p><img src="https://picr.oss-cn-qingdao.aliyuncs.com/img/202308121449718.png" alt="image-20230213163732427"></p>
<h4 id="之后就可以愉快的在舒适的-IDE-中进行编码了"><a href="#之后就可以愉快的在舒适的-IDE-中进行编码了" class="headerlink" title="之后就可以愉快的在舒适的 IDE 中进行编码了"></a>之后就可以愉快的在舒适的 IDE 中进行编码了</h4><h3 id="重定向-printf"><a href="#重定向-printf" class="headerlink" title="重定向 printf"></a>重定向 printf</h3><p>新建一个<code>retarget.h</code>文件内容如下：</p>
<pre><code class="c">#ifndef _RETARGET_H__
#define _RETARGET_H__

#include &quot;stm32f1xx_hal.h&quot;
#include &lt;sys/stat.h&gt;
#include &lt;stdio.h&gt;

void RetargetInit(UART_HandleTypeDef *huart);

int _isatty(int fd);

int _write(int fd, char *ptr, int len);

int _close(int fd);

int _lseek(int fd, int ptr, int dir);

int _read(int fd, char *ptr, int len);

int _fstat(int fd, struct stat *st);

#endif //#ifndef _RETARGET_H__
</code></pre>
<p>再新建一个<code>retarget.c</code>文件内容如下：</p>
<pre><code class="c">#include &lt;_ansi.h&gt;
#include &lt;_syslist.h&gt;
#include &lt;errno.h&gt;
#include &lt;sys/time.h&gt;
#include &lt;sys/times.h&gt;
#include &lt;retarget.h&gt;
#include &lt;stdint.h&gt;

#if !defined(OS_USE_SEMIHOSTING)

#define STDIN_FILENO  0
#define STDOUT_FILENO 1
#define STDERR_FILENO 2

UART_HandleTypeDef *gHuart;

void RetargetInit(UART_HandleTypeDef *huart) &#123;
    gHuart = huart;

    /* Disable I/O buffering for STDOUT stream, so that
     * chars are sent out as soon as they are printed. */
    setvbuf(stdout, NULL, _IONBF, 0);
&#125;

int _isatty(int fd) &#123;
    if (fd &gt;= STDIN_FILENO &amp;&amp; fd &lt;= STDERR_FILENO)
        return 1;

    errno = EBADF;
    return 0;
&#125;

int _write(int fd, char *ptr, int len) &#123;
    HAL_StatusTypeDef hstatus;

    if (fd == STDOUT_FILENO || fd == STDERR_FILENO) &#123;
        hstatus = HAL_UART_Transmit(gHuart, (uint8_t *) ptr, len, HAL_MAX_DELAY);
        if (hstatus == HAL_OK)
            return len;
        else
            return EIO;
    &#125;
    errno = EBADF;
    return -1;
&#125;

int _close(int fd) &#123;
    if (fd &gt;= STDIN_FILENO &amp;&amp; fd &lt;= STDERR_FILENO)
        return 0;

    errno = EBADF;
    return -1;
&#125;

int _lseek(int fd, int ptr, int dir) &#123;
    (void) fd;
    (void) ptr;
    (void) dir;

    errno = EBADF;
    return -1;
&#125;

int _read(int fd, char *ptr, int len) &#123;
    HAL_StatusTypeDef hstatus;

    if (fd == STDIN_FILENO) &#123;
        hstatus = HAL_UART_Receive(gHuart, (uint8_t *) ptr, 1, HAL_MAX_DELAY);
        if (hstatus == HAL_OK)
            return 1;
        else
            return EIO;
    &#125;
    errno = EBADF;
    return -1;
&#125;

int _fstat(int fd, struct stat *st) &#123;
    if (fd &gt;= STDIN_FILENO &amp;&amp; fd &lt;= STDERR_FILENO) &#123;
        st-&gt;st_mode = S_IFCHR;
        return 0;
    &#125;

    errno = EBADF;
    return 0;
&#125;

#endif //#if !defined(OS_USE_SEMIHOSTING)
</code></pre>
<p>添加这两个文件到工程，更新CMake</p>
<p>打开 cmakeLists.txt</p>
<p><img src="https://picr.oss-cn-qingdao.aliyuncs.com/img/202308121358943.png" alt="image-20230812135626077"></p>
<p>没有路径就添加后更新cmake，已有的话就直接更新</p>
<p><img src="https://picr.oss-cn-qingdao.aliyuncs.com/img/202308121358618.png" alt="image-20230812135841389"></p>
<p>编译之后会发现几个系统函数重复定义了，被重复定义的函数位于<code>Src</code>目录的<code>syscalls.c</code>文件中，我们把里面重复的几个函数删掉即可</p>
<p>在main函数的初始化代码中添加对头文件的引用并注册重定向的串口号：</p>
<pre><code class="text">#include &quot;retarget.h&quot;

RetargetInit(&amp;huart1);
</code></pre>
<p>上面的修改完成之后可能会发现无法正常读取浮点数</p>
<p>可以修改CMakeList.txt，加入下述编译选项</p>
<pre><code class="text">set(COMMON_FLAGS &quot;-specs=nosys.specs -specs=nano.specs -u _printf_float -u _scanf_float&quot;)
</code></pre>

                </div>

                <div class="menuShow">
                    <svg t="1663413277234" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2403" width="24" height="24">
                        <path
                            d="M640 192H224c-17.7 0-32-14.3-32-32s14.3-32 32-32h416c17.7 0 32 14.3 32 32s-14.3 32-32 32zM960 544H224c-17.7 0-32-14.3-32-32s14.3-32 32-32h736c17.7 0 32 14.3 32 32s-14.3 32-32 32zM640 896H224c-17.7 0-32-14.3-32-32s14.3-32 32-32h416c17.7 0 32 14.3 32 32s-14.3 32-32 32zM96 192H64c-17.7 0-32-14.3-32-32s14.3-32 32-32h32c17.7 0 32 14.3 32 32s-14.3 32-32 32zM96 544H64c-17.7 0-32-14.3-32-32s14.3-32 32-32h32c17.7 0 32 14.3 32 32s-14.3 32-32 32zM96 896H64c-17.7 0-32-14.3-32-32s14.3-32 32-32h32c17.7 0 32 14.3 32 32s-14.3 32-32 32z"
                            fill="#707070" p-id="2404" data-spm-anchor-id="a313x.7781069.0.i0" class="selected"></path>
                    </svg>
                </div>
                <div class="top">
                    <svg width="8" height="14" viewBox="0 0 8 14">
                        <path d="M7 1L1 7l6 6" stroke="#fff" stroke-width="2" fill="none" fill-rule="evenodd"
                            stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </div>
    </div>
    <div class="menu">
        <ul>
        </ul>
    </div>
</section>
<script src="/js/nav.js"></script>
<!-- 
<script src="/js/nav.js"></script>
 -->
                                        <div class="footer">
    <span>Copyright © 2022 iLx1</span>
</div>

<link rel="stylesheet" href="/css/nord.css" type="text/css" />
<script src="/js/highlight.min.js"></script>
<script src="/js/highlightjs-line-numbers.js"></script>

<!-- 
<link rel="stylesheet" href="/css/nord.css">

    
<script src="/js/highlight.min.js"></script>

        
<script src="/js/highlightjs-line-numbers.js"></script>
 -->

<script>
    hljs.initHighlightingOnLoad();
    hljs.initLineNumbersOnLoad();
</script>
            </div>
        </div>
        <script>
            const loader = document.querySelector('.load');
            const paper = document.querySelector('.paper');
            const ch_span = document.querySelector('.load .h-mes>#chs');
            const no_wait = document.querySelector('.load #noWait');
    
            const ch_array = ['" 或许再等一会.. "', '" 等待是为了更好的阅读体验 "', '" 就快加载完了 "', '" 还差一点... "', '" 感谢你的坚持 ! "']
            let i = 0, j = 0;
            var show_main = setInterval(() => {
                ch_span.innerHTML = ch_array[i];
                i > 3 ? i = 0 : i ++;
                j > 1 ? no_wait.style.display = 'block' : j ++;
            }, 1800);
            // console.log(23542365)
            window.addEventListener('load',showMain);
            no_wait.addEventListener('click', showMain);
    
            function showMain() {
                loader.style.display = 'none';
                paper.style.display = 'block';
                show_main = null;
                clearInterval(show_main);
                console.log(1)
            }
        </script>
    </body>
</html>